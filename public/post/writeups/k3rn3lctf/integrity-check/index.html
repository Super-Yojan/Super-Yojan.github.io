<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        Integrity Check ::
        Yojan&#39;s Blog
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="Attachment: File
Solution I started out by running the file.
java -jar IntegrityCheck.jar We can see that something is wrong in the function name.
Looking at the hint, we all can say that we have to use some sort of Java Bytecode modifying tool. So I searched up online and found quite a few.
The one that I found useful was the recaf
Opening the IntegrityCheck.jar file The class name looks really wrong."
/>
<meta
  name="keywords"
  content="Writeups Programming CTF Linux Hacking Computer"
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="/post/writeups/k3rn3lctf/integrity-check/" />





<link rel="stylesheet" href="/assets/style.css" />

<link rel="stylesheet" href="/style.css" />


<link
  rel="apple-touch-icon-precomposed"
  sizes="144x144"
  href="/img/apple-touch-icon-144-precomposed.png"
/>
<link rel="shortcut icon" href="/img/favicon.png" />


<link href="/assets/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Integrity Check"/>
<meta name="twitter:description" content="Attachment: File
Solution I started out by running the file.
java -jar IntegrityCheck.jar We can see that something is wrong in the function name.
Looking at the hint, we all can say that we have to use some sort of Java Bytecode modifying tool. So I searched up online and found quite a few.
The one that I found useful was the recaf
Opening the IntegrityCheck.jar file The class name looks really wrong."/>



<meta property="og:title" content="Integrity Check" />
<meta property="og:description" content="Attachment: File
Solution I started out by running the file.
java -jar IntegrityCheck.jar We can see that something is wrong in the function name.
Looking at the hint, we all can say that we have to use some sort of Java Bytecode modifying tool. So I searched up online and found quite a few.
The one that I found useful was the recaf
Opening the IntegrityCheck.jar file The class name looks really wrong." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/writeups/k3rn3lctf/integrity-check/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-11-15T15:38:22-05:00" />
<meta property="article:modified_time" content="2021-11-15T15:38:22-05:00" /><meta property="og:site_name" content="Yojan&#39;s Blog" />







  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >Yojan&#39;s Blog</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title">Integrity Check</h1>
    <div class="post-meta">
      
        <span class="post-date">
          2021-11-15
        </span>

        
          
        
      

      


      
        <span class="post-read-time"
          >— 3 min read</span
        >
      
    </div>

    

    

    <div class="post-content">
      
      <p><img src="/integrity/challengeDescription.png" alt=""></p>
<p>Attachment: <a href="https://github.com/Kasimir123/K3RN3LCTF-2021/blob/main/downloadable/integrity-check/IntegrityCheck.jar">File</a></p>
<h1 id="solution">Solution</h1>
<p>I started out by running the file.</p>
<pre tabindex="0"><code>java -jar IntegrityCheck.jar
</code></pre><p><img src="/integrity/initial_run.png" alt="Test"></p>
<p>We can see that something is wrong in the function name.</p>
<p>Looking at the hint, we all can say that we have to use some sort of Java Bytecode modifying tool. So I searched up online and found quite a few.</p>
<p>The one that I found useful was the <a href="https://www.coley.software/Recaf/">recaf</a></p>
<p>Opening the IntegrityCheck.jar file
<img src="/integrity/Opening.png" alt="Opening the file"></p>
<p>The class name looks really wrong. But what is the real name?</p>
<p>I tried looking around for the real name, I didn&rsquo;t find it until I used another tool. rej</p>
<p><img src="/integrity/ClassName.png" alt=""></p>
<p>With this tool we can see the source file name. I don&rsquo;t know why this is the case, but now I have my real class name.</p>
<p>Now to change the class name I first tried using rej to change it, it still gave me illegal method name error. So I changed the name of the function as well. After that it kept gave me <code>NullPointerException</code> because I wasn&rsquo;t changing it properly. I was able to fix that by using Recaf tool.</p>
<p>After changing the class and the method name I had the export to a new jar <code>changed.jar</code> . I was able to successfully run this jar using this command</p>
<p><code>java -jar changed.jar</code></p>
<p><img src="/integrity/changedRun.png" alt=""></p>
<p>Alr, Now there are no errors.</p>
<p>Time to find the password.
<img src="/integrity/password.png" alt="">
After just scanning the decompiled code, I was able to find place where they are validating the password.</p>
<pre tabindex="0"><code>String throw8 = throw6[0].getClassName();
</code></pre><p>It is storing the name of the class in the variable throw8. (Let&rsquo;s ignore other code for a while)</p>
<p>Then it&rsquo;s creating a new char array</p>
<pre tabindex="0"><code>char[] throw9 = throw8.toCharArray();
</code></pre><p>It basically converts the name of the class into an array of characters</p>
<p>After this command throw 9 would look something like</p>
<pre tabindex="0"><code>['D', 'e', 'c', 'r', 'y', 'p', 't', 'o', 'r']
</code></pre><p>Right after that there&rsquo;s a if statement that does some funky stuffs.</p>
<p>It&rsquo;s takes the first 4 characters from the <code>throw9</code> char array, and xor&rsquo;s it with some number to validate the input.
User given password is stored in <code>throw10</code> char array.</p>
<p>To find the correct password we can just xorg the the values that we already know</p>
<p><img src="/integrity/pythonscript.png" alt=""></p>
<p>I wrote a small python script to calculate the password. <code>GiCw:</code></p>
<p>After getting the password, I ran following command</p>
<pre tabindex="0"><code>java -jar changed.jar GiCw:
</code></pre><p><img src="/integrity/werid_output.png" alt=""></p>
<p>I got the following output. It wasn&rsquo;t the flag. I must have done something wrong.</p>
<p>After I re-analyze the code, I figured out that the code uses function name to compute the flag.</p>
<p><img src="/integrity/flag_code.png" alt=""></p>
<p>It uses the <code>throw7</code> variable, which takes the method name.</p>
<p>So, if I keep the original method name, it will give me error, and if I change it it will give me wrong flag.</p>
<p>After thinking for a while. I came up with two solutions.</p>
<ol>
<li>Write a script that replicates the behavior</li>
<li>Figure out a way to run using the original method name</li>
</ol>
<p>After searching online for a while I found this out <a href="https://bugs.java.com/bugdatabase/view_bug.do?bug_id=JDK-8214719">-Xverify:none</a>,using this tag I was able to run the jar even with the illegal method name.</p>
<p>I created <code>New-Integrity.jar</code> where I only changed the class name didn&rsquo;t touch the function name.</p>
<pre tabindex="0"><code>java -Xverify:none -jar New-Integrity.jar GiCw:
</code></pre><p>it gave me the flag: <code>flag{H3LL0_YOU_KN0W_SOURC3_FIL3}</code></p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >Read other posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="/post/writeups/htb-uni-ctf/lighttheway/">
                  <span class="button__icon">←</span>
                  <span class="button__text">HTB UNI CTF : Light The Way</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="/post/post2/">
                  <span class="button__text">Why everyone shouldn&#39;t use linux?</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    
      
        

      
    
  </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >Yojan&#39;s Blog</span
    >
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span
          >© 2021 Powered by
          <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span
        >
        <span
          >Theme created by
          <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span
        >
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script>
const images = Array.from(document.querySelectorAll(".post-content img"));
images.forEach(img => {
  mediumZoom(img, {
    margin: 0,  
    scrollOffset: 40,  
    container: null,  
    template: null  
  });
});
</script>


      
    </div>

    
  </body>
</html>
