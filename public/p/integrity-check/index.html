<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='Attachment: File
Solution I started out by running the file.
java -jar IntegrityCheck.jar  Test 
We can see that something is wrong in the function name.
Looking at the hint, we all can say that we have to use some sort of Java Bytecode modifying tool. So I searched up online and found quite a few.
The one that I found useful was the recaf
Opening the IntegrityCheck.'><title>Integrity Check</title>

<link rel='canonical' href='/p/integrity-check/'>

<link rel="stylesheet" href="/scss/style.min.63c512f9679a4af0b0a047e206183b4ca51e14499deb80ad27e2fcc1419df316.css"><meta property='og:title' content='Integrity Check'>
<meta property='og:description' content='Attachment: File
Solution I started out by running the file.
java -jar IntegrityCheck.jar  Test 
We can see that something is wrong in the function name.
Looking at the hint, we all can say that we have to use some sort of Java Bytecode modifying tool. So I searched up online and found quite a few.
The one that I found useful was the recaf
Opening the IntegrityCheck.'>
<meta property='og:url' content='/p/integrity-check/'>
<meta property='og:site_name' content='Yojan&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Kernel CTF' /><meta property='article:published_time' content='2021-11-15T15:38:22-05:00'/><meta property='article:modified_time' content='2021-11-15T15:38:22-05:00'/><meta property='og:image' content='/avatar.png' />
<meta name="twitter:site" content="@https://twitter.com/GautamYojan">
    <meta name="twitter:creator" content="@https://twitter.com/GautamYojan"><meta name="twitter:title" content="Integrity Check">
<meta name="twitter:description" content="Attachment: File
Solution I started out by running the file.
java -jar IntegrityCheck.jar  Test 
We can see that something is wrong in the function name.
Looking at the hint, we all can say that we have to use some sort of Java Bytecode modifying tool. So I searched up online and found quite a few.
The one that I found useful was the recaf
Opening the IntegrityCheck."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='/avatar.png' />
    </head>
    <body class="
    article-page 
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "dark");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        on-phone--column extended
    
">
    
        <aside class="sidebar left-sidebar sticky">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header class="site-info">
        
            
            <figure class="site-avatar">
                
                    <img src="/avatar.png" width="300" height="300" class="site-logo" loading="lazy" alt="Avatar">
                

                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <h1 class="site-name"><a href="/">Yojan&#39;s Blog</a></h1>
        <h2 class="site-description">I am a software developer.</h2><ol class="social-menu">
                
                    <li>
                        <a 
                            href='https://github.com/Super-Yojan'
                            target="_blank"
                            title="GitHub"
                        >
                            
                            
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                            
                        </a>
                    </li>
                
                    <li>
                        <a 
                            href='https://drmoscovium.net/index.xml'
                            target="_blank"
                            title="rss"
                        >
                            
                            
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="5" cy="19" r="1" />
  <path d="M4 4a16 16 0 0 1 16 16" />
  <path d="M4 11a9 9 0 0 1 9 9" />
</svg>



                            
                        </a>
                    </li>
                
                    <li>
                        <a 
                            href='https://twitter.com/GautamYojan'
                            target="_blank"
                            title="Twitter"
                        >
                            
                            
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                            
                        </a>
                    </li>
                
            </ol></header>

    <ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        

        
            <li id="dark-mode-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <span>Dark Mode</span>
            </li>
        
    </ol>
</aside>

    
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <h2 class="article-title">
        <a href="/p/integrity-check/">Integrity Check</a>
    </h2>

    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Nov 15, 2021</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    3 minute read
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <p><figure 
	>
	<a href="/integrity/challengeDescription.png" >
		<img src="/integrity/challengeDescription.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>Attachment: <a class="link" href="https://github.com/Kasimir123/K3RN3LCTF-2021/blob/main/downloadable/integrity-check/IntegrityCheck.jar"  target="_blank" rel="noopener"
    >File</a></p>
<h1 id="solution">Solution</h1>
<p>I started out by running the file.</p>
<pre tabindex="0"><code>java -jar IntegrityCheck.jar
</code></pre><p><figure 
	>
	<a href="/integrity/initial_run.png" >
		<img src="/integrity/initial_run.png"
			
			
			
			loading="lazy"
			alt="Test">
	</a>
	
	<figcaption>Test</figcaption>
	
</figure></p>
<p>We can see that something is wrong in the function name.</p>
<p>Looking at the hint, we all can say that we have to use some sort of Java Bytecode modifying tool. So I searched up online and found quite a few.</p>
<p>The one that I found useful was the <a class="link" href="https://www.coley.software/Recaf/"  target="_blank" rel="noopener"
    >recaf</a></p>
<p>Opening the IntegrityCheck.jar file
<figure 
	>
	<a href="/integrity/Opening.png" >
		<img src="/integrity/Opening.png"
			
			
			
			loading="lazy"
			alt="Opening the file">
	</a>
	
	<figcaption>Opening the file</figcaption>
	
</figure></p>
<p>The class name looks really wrong. But what is the real name?</p>
<p>I tried looking around for the real name, I didn&rsquo;t find it until I used another tool. rej</p>
<p><figure 
	>
	<a href="/integrity/ClassName.png" >
		<img src="/integrity/ClassName.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>With this tool we can see the source file name. I don&rsquo;t know why this is the case, but now I have my real class name.</p>
<p>Now to change the class name I first tried using rej to change it, it still gave me illegal method name error. So I changed the name of the function as well. After that it kept gave me <code>NullPointerException</code> because I wasn&rsquo;t changing it properly. I was able to fix that by using Recaf tool.</p>
<p>After changing the class and the method name I had the export to a new jar <code>changed.jar</code> . I was able to successfully run this jar using this command</p>
<p><code>java -jar changed.jar</code></p>
<p><figure 
	>
	<a href="/integrity/changedRun.png" >
		<img src="/integrity/changedRun.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>Alr, Now there are no errors.</p>
<p>Time to find the password.
<figure 
	>
	<a href="/integrity/password.png" >
		<img src="/integrity/password.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure>
After just scanning the decompiled code, I was able to find place where they are validating the password.</p>
<pre tabindex="0"><code>String throw8 = throw6[0].getClassName();
</code></pre><p>It is storing the name of the class in the variable throw8. (Let&rsquo;s ignore other code for a while)</p>
<p>Then it&rsquo;s creating a new char array</p>
<pre tabindex="0"><code>char[] throw9 = throw8.toCharArray();
</code></pre><p>It basically converts the name of the class into an array of characters</p>
<p>After this command throw 9 would look something like</p>
<pre tabindex="0"><code>[&#39;D&#39;, &#39;e&#39;, &#39;c&#39;, &#39;r&#39;, &#39;y&#39;, &#39;p&#39;, &#39;t&#39;, &#39;o&#39;, &#39;r&#39;]
</code></pre><p>Right after that there&rsquo;s a if statement that does some funky stuffs.</p>
<p>It&rsquo;s takes the first 4 characters from the <code>throw9</code> char array, and xor&rsquo;s it with some number to validate the input.
User given password is stored in <code>throw10</code> char array.</p>
<p>To find the correct password we can just xorg the the values that we already know</p>
<p><figure 
	>
	<a href="/integrity/pythonscript.png" >
		<img src="/integrity/pythonscript.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>I wrote a small python script to calculate the password. <code>GiCw:</code></p>
<p>After getting the password, I ran following command</p>
<pre tabindex="0"><code>java -jar changed.jar GiCw:
</code></pre><p><figure 
	>
	<a href="/integrity/werid_output.png" >
		<img src="/integrity/werid_output.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>I got the following output. It wasn&rsquo;t the flag. I must have done something wrong.</p>
<p>After I re-analyze the code, I figured out that the code uses function name to compute the flag.</p>
<p><figure 
	>
	<a href="/integrity/flag_code.png" >
		<img src="/integrity/flag_code.png"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>It uses the <code>throw7</code> variable, which takes the method name.</p>
<p>So, if I keep the original method name, it will give me error, and if I change it it will give me wrong flag.</p>
<p>After thinking for a while. I came up with two solutions.</p>
<ol>
<li>Write a script that replicates the behavior</li>
<li>Figure out a way to run using the original method name</li>
</ol>
<p>After searching online for a while I found this out <a class="link" href="https://bugs.java.com/bugdatabase/view_bug.do?bug_id=JDK-8214719"  target="_blank" rel="noopener"
    >-Xverify:none</a>,using this tag I was able to run the jar even with the illegal method name.</p>
<p>I created <code>New-Integrity.jar</code> where I only changed the class name didn&rsquo;t touch the function name.</p>
<pre tabindex="0"><code>java -Xverify:none -jar New-Integrity.jar GiCw:
</code></pre><p>it gave me the flag: <code>flag{H3LL0_YOU_KN0W_SOURC3_FIL3}</code></p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/kernel-ctf/">Kernel CTF</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    <aside class="related-contents--wrapper">
    
    
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2022 Yojan&#39;s Blog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.6.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
